//	@file Version: 1.0
//	@file Name: createCourse.sqf
//	@file Description: client createCourse 
//	@file Author: RaminNoodle
//	@file Created: 9/10/2014 

if (isDedicated) exitWith {}; 

raceCourseArray = [ 
				["Track 1",
					[
						[[1866.65,5889,71.7462],[0.900203,0.431996,-0.0548962],[0.375251,-0.705568,0.601133]],
						[[1934.5,5784.5,76.9431],[0.257613,-0.569596,-0.78051],[0.604465,-0.535192,0.590077]],
						[[2074.96,5604.63,40.6909],[0.572158,-0.743964,-0.345184],[-0.361111,-0.606412,0.708423]],
						[[2129.32,5316.97,45.1316],[0.0807499,-0.965191,-0.248769],[-0.60231,-0.246112,0.759376]],
						[[2100.27,5005.97,25.3122],[-0.156524,-0.954918,-0.252253],[-0.0352974,-0.249829,0.967646]],
						[[2052.59,4678.86,33.9596],[-0.18638,-0.9619,-0.200027],[-0.273821,-0.14467,0.950838]],
						[[1955.5,4365.5,37.0544],[-0.337845,-0.929756,-0.14634],[0.135326,-0.201851,0.970022]],
						[[2031.87,4078.1,47.5405],[0.841044,-0.532762,-0.0938569],[0.530148,0.777202,0.338969]],
						[[2389.2,4022.61,45.106],[0.977864,-0.15616,-0.139272],[-0.0149053,-0.715894,0.69805]],
						[[2721.17,3918.32,76.319],[0.990126,-0.139719,-0.0113437],[0.13648,0.942376,0.305451]],
						[[3053.87,4032.49,82.5311],[0.898255,0.439386,-0.00884501],[0.0206979,-0.0221924,0.999539]],
						[[3364.16,4166.94,114.252],[0.950366,0.302915,-0.0710434],[0.297137,-0.815918,0.495971]],
						[[3688.56,4082.03,116.388],[0.874219,-0.473636,-0.106816],[0.0235451,-0.178383,0.983679]],
						[[3974.27,3890.08,151.065],[0.809853,-0.584647,-0.0482258],[0.0095264,-0.0690903,0.997565]],
						[[4225.87,3727.61,226.502],[0.934669,-0.319072,0.1568],[0.232578,0.882346,0.409112]],
						[[4511.5,3716.5,213.604],[0.819776,-0.00519293,-0.572661],[0.562814,-0.177552,0.807289]],
						[[4832.5,3675.5,101.594],[0.855923,-0.137071,-0.498606],[0.481721,-0.139184,0.865201]],
						[[5187.66,3587.09,98.001],[0.859719,-0.474261,-0.18963],[0.505368,0.735994,0.450462]],
						[[5482.5,3718.5,65.0276],[0.670319,0.683183,-0.289713],[-0.0671165,0.444625,0.893199]],
						[[5747,3993.37,56.7456],[0.712131,0.654917,-0.252891],[0.215953,0.138405,0.966545]],
						[[5996.5,4259.5,40.7457],[0.604428,0.780836,-0.157991],[0.0330572,0.173564,0.984268]],
						[[6243.92,4507.7,52.6667],[0.738262,0.60079,-0.306627],[0.397662,-0.020487,0.917303]],
						[[6517.5,4722.5,38.1386],[0.576975,0.806719,-0.127691],[-0.395717,0.412867,0.820334]],
						[[6669.5,5052.5,48.8483],[0.433875,0.896224,-0.0923798],[-0.349151,0.261773,0.89976]],
						[[6631.84,5351.38,75.5267],[-0.807499,0.588105,-0.045575],[-0.580712,-0.779029,0.236405]],
						[[6312.5,5369.5,35.6813],[-0.984708,-0.112431,-0.133077],[-0.121444,-0.104681,0.987063]],
						[[5974.24,5386.06,62.2886],[-0.972515,0.220588,-0.0745353],[0.0636507,0.559784,0.82619]],
						[[5688.81,5547.45,92.5508],[-0.844289,0.535465,-0.0212663],[0.0817654,0.167939,0.9824]],
						[[5453.5,5739.5,142.755],[-0.762473,0.632845,-0.134691],[-0.11207,0.0758497,0.990801]],
						[[5205.24,5867.36,197.334],[-0.969729,0.225966,0.0925498],[0.0880732,-0.0298347,0.995667]],
						[[4956.5,5928.5,234.406],[-0.885629,0.112109,-0.450657],[-0.216845,0.7583,0.614784]],
						[[4716.53,6063.16,148.666],[-0.747233,0.514896,-0.420148],[-0.344776,0.240121,0.907453]],
						[[4502.02,6310.81,106.807],[0.132112,0.982714,0.129693],[0.837397,-0.180659,0.515876]],
						[[4632.5,6524.5,156.656],[0.668722,0.724917,-0.165245],[-0.454018,0.574136,0.681348]],
						[[4592.5,6772.5,152.563],[-0.422896,0.809642,-0.406988],[-0.499474,0.166479,0.850182]],
						[[4409.11,7039.68,66.124],[-0.493156,0.750085,-0.440646],[-0.2581,0.357564,0.897515]],
						[[4200.5,7341.5,27.9123],[-0.594924,0.798722,-0.0900465],[-0.111836,0.0286841,0.993313]],
						[[3919.5,7567.5,93.7421],[-0.890866,0.451951,-0.0458138],[-0.312892,-0.537372,0.783153]],
						[[3604.5,7656.5,50.3149],[-0.976089,0.0370366,-0.214194],[-0.176604,-0.709624,0.682089]],
						[[3313.78,7495.4,59.4568],[-0.716543,-0.697077,-0.0254835],[0.0339639,-0.0713557,0.996872]]
					]
				],
				["Track 2",
					[
						[[1934.5,5784.5,76.9431],[0.257613,-0.569596,-0.78051],[0.604465,-0.535192,0.590077]],
						[[2074.96,5604.63,40.6909],[0.572158,-0.743964,-0.345184],[-0.361111,-0.606412,0.708423]],
						[[2129.32,5316.97,45.1316],[0.0807499,-0.965191,-0.248769],[-0.60231,-0.246112,0.759376]],
						[[1955.5,4365.5,37.0544],[-0.337845,-0.929756,-0.14634],[0.135326,-0.201851,0.970022]],
						[[2031.87,4078.1,47.5405],[0.841044,-0.532762,-0.0938569],[0.530148,0.777202,0.338969]],
						[[2389.2,4022.61,45.106],[0.977864,-0.15616,-0.139272],[-0.0149053,-0.715894,0.69805]],
						[[2721.17,3918.32,76.319],[0.990126,-0.139719,-0.0113437],[0.13648,0.942376,0.305451]],
						[[3053.87,4032.49,82.5311],[0.898255,0.439386,-0.00884501],[0.0206979,-0.0221924,0.999539]],
						[[3364.16,4166.94,114.252],[0.950366,0.302915,-0.0710434],[0.297137,-0.815918,0.495971]],
						[[3688.56,4082.03,116.388],[0.874219,-0.473636,-0.106816],[0.0235451,-0.178383,0.983679]],
						[[3974.27,3890.08,151.065],[0.809853,-0.584647,-0.0482258],[0.0095264,-0.0690903,0.997565]],
						[[4225.87,3727.61,226.502],[0.934669,-0.319072,0.1568],[0.232578,0.882346,0.409112]],
						[[4511.5,3716.5,213.604],[0.819776,-0.00519293,-0.572661],[0.562814,-0.177552,0.807289]],
						[[4832.5,3675.5,101.594],[0.855923,-0.137071,-0.498606],[0.481721,-0.139184,0.865201]],
						[[5187.66,3587.09,98.001],[0.859719,-0.474261,-0.18963],[0.505368,0.735994,0.450462]],
						[[5482.5,3718.5,65.0276],[0.670319,0.683183,-0.289713],[-0.0671165,0.444625,0.893199]],
						[[5747,3993.37,56.7456],[0.712131,0.654917,-0.252891],[0.215953,0.138405,0.966545]],
						[[5996.5,4259.5,40.7457],[0.604428,0.780836,-0.157991],[0.0330572,0.173564,0.984268]],
						[[6243.92,4507.7,52.6667],[0.738262,0.60079,-0.306627],[0.397662,-0.020487,0.917303]],
						[[6517.5,4722.5,38.1386],[0.576975,0.806719,-0.127691],[-0.395717,0.412867,0.820334]],
						[[6669.5,5052.5,48.8483],[0.433875,0.896224,-0.0923798],[-0.349151,0.261773,0.89976]],
						[[6631.84,5351.38,75.5267],[-0.807499,0.588105,-0.045575],[-0.580712,-0.779029,0.236405]],
						[[6312.5,5369.5,35.6813],[-0.984708,-0.112431,-0.133077],[-0.121444,-0.104681,0.987063]],
						[[5974.24,5386.06,62.2886],[-0.972515,0.220588,-0.0745353],[0.0636507,0.559784,0.82619]],
						[[5688.81,5547.45,92.5508],[-0.844289,0.535465,-0.0212663],[0.0817654,0.167939,0.9824]],
						[[5453.5,5739.5,142.755],[-0.762473,0.632845,-0.134691],[-0.11207,0.0758497,0.990801]],
						[[5205.24,5867.36,197.334],[-0.969729,0.225966,0.0925498],[0.0880732,-0.0298347,0.995667]],
						[[4956.5,5928.5,234.406],[-0.885629,0.112109,-0.450657],[-0.216845,0.7583,0.614784]],
						[[4716.53,6063.16,148.666],[-0.747233,0.514896,-0.420148],[-0.344776,0.240121,0.907453]],
						[[4502.02,6310.81,106.807],[0.132112,0.982714,0.129693],[0.837397,-0.180659,0.515876]],
						[[4632.5,6524.5,156.656],[0.668722,0.724917,-0.165245],[-0.454018,0.574136,0.681348]],
						[[4592.5,6772.5,152.563],[-0.422896,0.809642,-0.406988],[-0.499474,0.166479,0.850182]],
						[[4409.11,7039.68,66.124],[-0.493156,0.750085,-0.440646],[-0.2581,0.357564,0.897515]],
						[[4200.5,7341.5,27.9123],[-0.594924,0.798722,-0.0900465],[-0.111836,0.0286841,0.993313]],
						[[3919.5,7567.5,93.7421],[-0.890866,0.451951,-0.0458138],[-0.312892,-0.537372,0.783153]],
						[[3604.5,7656.5,50.3149],[-0.976089,0.0370366,-0.214194],[-0.176604,-0.709624,0.682089]],
						[[3313.78,7495.4,59.4568],[-0.716543,-0.697077,-0.0254835],[0.0339639,-0.0713557,0.996872]]
					]
				]
			];

checkPointArray=[];

raceRoute = (raceCourseArray select (_this select 0)) select 1;
_wp = gp addWaypoint [(raceRoute select 0) select 0, 0];
//hint "GO";
{
	_script = [_x, _forEachIndex] spawn {
		_tmpObj = createVehicle ["Sign_Circle_F",(_this select 0) select 0,[],0,"NONE"];
		_tmpObj setPosASL (_this select 0) select 0;
		_tmpObj setVectorDirAndUp [(_this select 0) select 1,(_this select 0) select 2];
		checkPointArray pushBack _tmpObj
	};
	waitUntil {scriptDone _script};
} forEach raceRoute;


0 = checkPointArray spawn {
	private ["_circleArray","_currentIndex","_startTime","_curTrigger"];
    _circleArray = _this;
    _currentIndex = 0;
    _startTime = -1;
    waitUntil {player == player};
    while {true} do {
        {
            _x setObjectTexture [0, "#(argb,8,8,3)color(0,1,1,1)"];
        } forEach _circleArray;
        _curTrigger = _circleArray select _currentIndex;
        _curTrigger setObjectTexture [0, "#(argb,8,8,3)color(1,0,0,1)"];
        waitUntil {(player distanceSqr _curTrigger) < 220};
        if (_currentIndex == 0) then {_startTime = time;};
        _currentIndex = (_currentIndex + 1) % (count _circleArray);
        _curTrigger = _circleArray select _currentIndex;        
        hint format ["Checkpoint complete, next checkpoint %2 meters.", _currentIndex, floor (player distance _curTrigger)];
	    _wp = gp addWaypoint [getPos _curTrigger, _currentIndex];
    };
};
